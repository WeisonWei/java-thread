# 网络协议
网络协议之前必须要先了解`TCP/IP`和`OSI`模型;
简单来说,OSI 是一个具有参考意义的标准框架。
TCP/IP模型是目前应用最广的工业模型。

## 1.网络通信方式
### 全双工 半双工 单工
全双工: 表示A可以给B发送数据的同时,B也可以给A发送数据。
半双工：表示A给B发送数据的时候,B不能给A发送数据。当B给A发送数据的时候,A不能给B发送数据。
单工： 表示要么是A只可以给B发送数据,或者B只能给A发送数据。数据是单向发送的不是双向的。

## 2.网络通信模型
### 2.1 OSI七层模型
网络七层协议:
1. 物理层
2. 数据链路层
3. 网络层
4. 传输层
5. 会话层
6. 表示层
7. 应用层

其中物理层、数据链路层和网络层通常被称作媒体层,是网络工程师所研究的对象；传输层、会话层、表示层和应用层则被称作主机层,是用户所面向和关心的内容。

### 2.2 IPS(TCP/IP)四层模型
TCP/IP是一个协议族,它是一套支持网络通信的协议集合,该模型下很多其它协议是基于TCP/IP实现的。
互联网协议（英语：Internet Protocol Suite,缩写 IPS）是一个网络通信模型,以及一整个网络传输协议家族,为互联网的基础通信架构;
它常被通称为TCP/IP协议族（英语：TCP/IP Protocol Suite,或TCP/IP Protocols）,简称 TCP/IP;

网络四层协议:
1. 应用层
2. 传输层
3. 网络层
4. 网络接口层

分为四个层次：网络层、传输层、应用层和网络接口层,不同的层有不同的协议。
在网络层有：IP协议、ICMP协议、ARP协议、RARP协议和BOOTP协议。
在传输层中有：TCP协议与UDP协议。
在应用层有：FTP、HTTP、TELNET、SMTP、DNS等协议。 

应用层：应用程序间沟通的层,如简单电子邮件传输（SMTP）、文件传输协议（FTP）、网络远程访问协议（Telnet）等。
传输层：在此层中,它提供了节点间的数据传送服务,如传输控制协议（TCP）、用户数据报协议（UDP）等,TCP和UDP给数据包加入传输数据并把它传输到下一层中,这一层负责传送数据,并且确定数据已被送达并接收。
网络层：负责提供基本的数据封包传送功能,让每一块数据包都能够到达目的主机（但不检查是否被正确接收）,如网际协议（IP）。
网络接口层：对实际的网络媒体的管理,定义如何使用实际网络（如Ethernet、Serial Line等）来传送数据。

## 3 常用协议
常用协议分别位于传输层和应用层;
TCP是一种流模式的协议,UDP是一种数据报模式的协议
UDP : 是TCP/IP四层模型中传输层中的一种协议。
HTTP: 是TCP/IP四层模型中应用层一种的协议。
Socket：是TCP/IP四层模型应用层和传输层的一种抽象层。

### 3.1 TCP(三次握手)
传输控制协议（英语：Transmission Control Protocol,缩写为TCP）是一种面向连接的、可靠的、基于字节流的传输层通信协议,由IETF的RFC 793定义。( 维基百科 )
TCP 是面向连接的,数据通信之前必须要建立连接,这个连接可以是 1 对多。
TCP 特性
1.面向连接可靠的传输协议。
2.不支持组播地址,仅支持单播地址。
3.传输基于字节流,不是报文。
4.通过滑动窗口机制实现流量控制,根据网络状态动态改变窗口的大小进行拥塞控制。
5.支持对数据进行分节排序,保证数据完整型以及正确性。
6.通过序号的确认和重发,确保传输的可靠性

### 3.2 UDP
用户数据报协议（英语：User Datagram Protocol,缩写为UDP）,又称使用者资料包协定,是一个简单的面向数据报的传输层 协议,正式规范为RFC 768。( 维基百科 )

UDP与TCP相比主要有以下特征：

    UDP 继承 IP 的特性,不保证不丢失,不保证按顺序到达。TCP 就是提供可靠的数据,无差错、不丢失、不重复、按循序到达。
    UDP 是面向无连接的,那什么是面向连接的呢？所谓面向连接：就是建立连接,是为了在客户端和服务端维护连接,而建立的一定的数据结构来维护双方交互的砖头,用这样的数据结构来保证所谓的面向连接的特性。
    UDP 是数据格式基于数据报,一个一个的发,一个一个的收。TCP 是面向字节流,发送的是一个流数据。
    UDP 是不处理堵塞,应用需要发,就会发送。TCP 还=拥有堵塞控制,TCP 会根据网络环境调整发包的频率。
    UDP 支持多播和广播。（在 C 类 IP 地址中,主机号为 255 的就是表示,广播地址。网络中所有的主机都能接收。192.168.1.255 - 广播地址）

UDP 的应用场景：
1、网络相对稳定的内网或者其他对数据丢包要求不是特别高的应用。
2、不需要建立一对一的连接、可以进行广播通信的应用。
3、应用要求处理数据块,时延要求低,但是对网络堵塞和数据排序没有要求。

### 3.3 HTTP
超文本传输协定（英文：HyperText Transfer Protocol,缩写：HTTP）是一种用于分布式、协作式和超媒体信息系统的应用层协议[1]。
HTTP是全球资讯网的数据通信的基础 ( 维基百科 )。

### 3.4 Socket
Socket: 英语中直意是插口、插座,我们一般叫做套接字,来源于Unix。     
Socket与其他三者不一样,Socket的本质是编程的接口也就是API, 是应用层和传输层的一个抽象层。
在Linux内核中,Socket就是一个文件形式存在（Unix/Linux基本哲学之一就是“一切皆文件”）,一些Socket函数对这个文件进行的操作。
就是我们常见的Socket API,可以理解为一个操作“文件”的API;

Socket有三种模式：
1）流式套接字 --> 基于TCP/IP
它提供了一种可靠的、面向连接的双向数据传输服务,实现了数据无差错、无重复的发送。
2）数据报套接字 --> 基于UDP
它提供了一种无连接、不可靠的双向数据传输服务。
3）原始套接字 --> 基于IP或ICMP
该套接字允许对较低层协议（如IP或ICMP）进行直接访问,常用于网络协议分析,检验新的网络协议实现,也可用于测试新配置或安装的网络设备。

> https://baike.baidu.com/item/%E5%A5%97%E6%8E%A5%E5%AD%97/9637606?fromtitle=socket&fromid=281150&fr=aladdin#3

### 总结 
综上：
TCP 、UDP、HTTP是网络协议中一种。
TCP和UDP属于传输层协议。
HTTP属于应用层协议。
而Socket可以理解为一个操作“文件”的API。

> https://www.jianshu.com/p/1c06088f3abe

## 4 相关协议概念
RMI和RPC是容易跟网络协议混乱的协议;
> https://www.jianshu.com/p/b0251b1c61dd
> https://zhuanlan.zhihu.com/p/50678735ø
### 4.1 RMI
在本地和服务端都启动一个辅助类,来进行socket通信,能够让在客户端Java虚拟机上的对象像调用本地对象一样调用服务端Java虚拟机中的对象上的方法；
RMI既然是java团队设计出来的rpc框架,虽然现在已经不适合企业级生产使用,但是其中的思想和规范值得学习;

实现RMI所需要的API基本都在三大类中,如下:
java.rmi：提供客户端需要的类、接口和异常；
java.rmi.server：提供服务端需要的类、接口和异常；
java.rmi.registry：提供注册表的创建以及查找和命名远程对象的类、接口和异常 ；


### 4.2 RPC
LRC --> 本地调用
RPC --> 隐藏通信细节(多种通信实现),在本地启一个代理,像本地一样地调用远程接口

RPC信息协议由两个不同结构组成：调用信息和答复信息。
在 RMI 调用中,有以下几个核心的概念：
1.通过接口进行远程调用
2.通过客户端的Stub对象和服务端的Skeleton对象的帮助将远程调用伪装成本地调用
3.通过RMI注册服务完成服务的注册和发现


### 4.3 RPC与RMI的区别
#### 1 方法调用方式不同
RMI中是通过在客户端的Stub对象作为远程接口进行远程方法的调用。
每个远程方法都具有方法签名,如果一个方法在服务器上执行,但是没有相匹配的签名被添加到这个远程接口(stub)上,那么这个新方法就不能被RMI客户方所调用。

RPC中是通过网络服务协议向远程主机发送请求,请求包含了一个参数集和一个文本值,通常形成“classname.methodname(参数集)”的形式。
RPC远程主机就去搜索与之相匹配的类和方法,找到后就执行方法并把结果编码,通过网络协议发回。

#### 2 适用语言范围不同
RMI只用于Java,RPC是网络服务协议,与操作系统和语言无关。


#### 3 调用结果的返回形式不同
Java是面向对象的,所以RMI的调用结果可以是对象类型或者基本数据类型；
RMI的结果统一由外部数据表示 (External Data Representation, XDR) 语言表示,这种语言抽象了字节序类和数据类型结构之间的差异。

现实中不直接使用RMI作为远程调用的原因：

    底层是BIO、而不是NIO
    其只能用于Java,不能扩展其他语言
    底层序列化使用JDK的序列化机制,效率不高












